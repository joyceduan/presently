<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

		<link rel="icon" type="image/png" href="presently.png" />

 	    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
		<script src="semantic/out/semantic.js"></script>
		<script src="semantic/out/semantic.min.js"></script>

		<link rel="stylesheet" type="text/css" href="semantic/out/semantic.css">	
		<link rel="stylesheet" type="text/css" href="semantic/out/semantic.min.css">
		<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
	</head>
		<div class="ui grid">
			<div class="sixteen wide column"></div>
			<div class="fifteen wide column"></div>
		</div>
		
		<div class="ui pointing menu">
			  <a class = "item" href = "presentlyprofile.html" >
			    Profile
			  </a>
			  <a class="item" href = "presentlybrowse.html"  >
			    Browse
			  </a>
			  <a class="active item" href = "presentlyevents.html">
			    Events
			  </a>
        		<a class="item"  href = "presentlysignup.html" >
          		Make New Profile
        		</a>
			  <a class="ui item" href = "presentlylogin.html" >
			  	Logout
			  </a>
		</div>
			<body>
			<div class="ui grid">
		 
		 	<div class = "two wide column"></div>
		 	<div class = "six wide column">
		 	<br><br><br>
		 	<font color="white" face ="verdana" align = "center">
		 <div class="ui link cards" id = "giftsILike"><u>Gifts I Like:</u></font></div>
		 <br><br>
		 <p id = "sameTagFriends"><font size="5"><b><u>People with similar personalities: </u></b></font></p>
		 <br> <br>
		 <div class = "two wide column"></div>
		 <div class="ui large header" id = "personalityTags"><b><u>Personality Tags:</u></b></div>
		</font>
		</div>

		<div class="ui card">

   		<img class = "ui medium circular image" src= "http://skiuwi.com/Skiuwi/img/GenericUser.png" id = "profilepic">
  		<div class="content">
  		<a class="header" id = "displayUserName">User </a>
    	<div class="meta">
      	<span class="date">Joined in 2015</span>
  		</div>
  		<div class="extra content">
    		<a>
      		<i class="user icon"></i>
      		22 Friends
    		</a>
    	</div>
		</div> 
		</div>
		<div class="six wide column"></div>
		<div class="one wide column"></div>
		<div class="sixteen wide column"></div>
		<div class="one wide column"></div>
		
		<div class="ten wide column"></div>
		<div class="four wide column"></div>
		
		<div class="one wide column"></div>
		<div class="four wide column"></div>
		
		
    
    	<style type="text/css">
			body {
			background: coral;
			font-color: white;
			color:white;
			
		}

		</style>
    </body>
    <script language="javascript" type="text/javascript">
    	var myDataRef = new Firebase('https://luminous-torch-1254.firebaseio.com/Users');
    	var username = localStorage.getItem("username");
    	document.getElementById("displayUserName").innerHTML = username;
    	var userData;
		myDataRef.once("value", function(snapshot){ //snapshot = all users
    			var data = snapshot.child(username);
    			userData = data.val();
    			pTags = userData.likes;
    			myItems = userData.items;
   	        	console.log(userData);
    		 	//document.getElementById('personalityTags').innerHTML = "Personality Tags: " + userData.likes;
    		 	document.getElementById('personalityTags').style.color = '#FFFFFF'
    		 	document.getElementById('giftsILike').style.color = '#FFFFFF'
    		 	if(userData.profilepicURL !== ""){
    		 		document.getElementById("profilepic").src = userData.profilepicURL;    		 	
    		 	}

    		 	var tagLinks = document.createElement("p");
    		 	for (item in userData.likes){
    		        tag = pTags[item];
    		 		var x = document.createElement("a");
    		 		x.innerHTML = tag;
    		 		browsePage = 'presentlybrowse.html?tag='+tag;
    		 		x.setAttribute("href", browsePage);
    		 		tagLinks.appendChild(x);
    		 		tagLinks.appendChild(document.createTextNode(", "));
 					
    		 	}
    		 	document.getElementById("personalityTags").appendChild(tagLinks); 
    		 	document.getElementById("sameTagFriends").innerHTML += '<br></br>'

    		 	var cardGroup = document.getElementById('giftsILike');
    		 	itemDataRef = new Firebase('https://luminous-torch-1254.firebaseio.com/Objects');
    		 	snapshot.forEach(function(childSnapshot) {
    		 		childObj = childSnapshot.key();
    		 		childRank = childSnapshot.val();
    		 		thisItemRef = itemDataRef.child(childObj);

            thisItemRef.once("value", function(snapshot){
                  thisItemData = snapshot.val();
                  alert(snapshot.key());
                  card = document.createElement("div");
             		 	  card.setAttribute("class", "card");
              			var itemImage = document.createElement("img");
              			itemImage.setAttribute("src", thisItemData.image);
              			itemImage.setAttribute("height", "300");
              			itemImage.setAttribute("width", "270");
            			card.appendChild(itemImage);
            			var likeButton = document.createElement('span');
              				likeButton.setAttribute('class', 'right floated');
              				var likeicon = document.createElement('i');
              				likeicon.setAttribute('class', 'right floated like icon');
              				likeButton.appendChild(likeicon);
              				likeButton.addEventListener('click', function(){
                  				var myUserRef = myDataRef.child(username);
                 				   myUserRef.once("value", function(snapshot){
                    				  var myData = snapshot.val();
                   					  var myLikes = myData.items;
                    				  myLikes.unshift(childKey);
                     				  myUserRef.child('items').update(myLikes);
                     				 });
                 			});
                 	cardGroup.appendChild(card);
                  
            });
    		 	});

    		 	
    		 	snapshot.forEach(function(childSnapshot) {
   
    	var key = childSnapshot.key(); // key = username
    	var childData = childSnapshot.val();
    	var childLikes = childData.likes;
    	var added = [];
  
    	for(i = 0; i < childLikes.length; i++){
    		var theirLike = childLikes[i];
    		if(pTags.indexOf(theirLike) != -1 && key != username && added.indexOf(key) == -1){
    			added.push(key);
    			document.getElementById("sameTagFriends").innerHTML += ('<b>' + key );
    		}
    	}
    	
    });
		});

	itemDataRef = myDataRef.child('Objects');
        itemDataRef.once("value", function(snapshot){
        
        

        snapshot.forEach(function(childSnapshot) {
            childData = childSnapshot.val();
            childKey = childSnapshot.key();
            card = document.createElement("div");
              card.setAttribute("class", "card");
              var itemImage = document.createElement("img");
              itemImage.setAttribute("src", childData.image);
              itemImage.setAttribute("height", "60");
              itemImage.setAttribute("width", "60");
            card.appendChild(itemImage);

            var likeButton = document.createElement('span');
              likeButton.setAttribute('class', 'right floated');
              var likeicon = document.createElement('i');
              likeicon.setAttribute('class', 'right floated like icon');
              likeButton.appendChild(likeicon);
              likeButton.addEventListener('click', function(){
                  myUserRef = myDataRef.child('Users').child(username);
                  myUserRef.once("value", function(snapshot){
                    myData = snapshot.val();
                    var myLikes = myData.items;
                    myLikes.push(childKey);
                     myUserRef.child('items').update(myLikes);
                      });
                  
  
            });

            var buyButton = document.createElement('a');
              var buyicon = document.createElement('i');
              buyicon.setAttribute('class', 'right floated dollar icon');
              buyButton.appendChild(buyicon);
              buyButton.setAttribute('href', childData.link);
              buyButton.setAttribute('target', "_blank");

            var content = document.createElement('div');
              content.setAttribute('class', 'content');
              content.appendChild(likeButton);
              content.appendChild(buyButton);

            card.appendChild(content);
            card.setAttribute("id", childData.name);
            cardGroup.appendChild(card);
            //cardGroup.appendChild(document.createElement("br"));
            //generate unique key, (key) then add that as id
        });
      });
	
		// alert('hello');
		// var newDiv = document.createElement("img");
		// //newDiv.setAttribute('id',);
		// newDiv.setAttribute("src","http://blog.cashcrate.com/wp-content/uploads/2014/08/Taco.png");
		// alert('hello');
		// document.getElementbyId('giftsILike').appendChild(newDiv);
		// alert(userData.items));
		
    </script>
</html>
